# مستندات توابع پروژه (Function Documentation)

این سند توابع اصلی و سرویس‌های استفاده شده در برنامه Janpanah Shelter AI را تشریح می‌کند. هدف آن ارائه یک مرجع فنی برای توسعه و نگهداری آسان‌تر است. برای مشاهده طرح کلی و مفهومی ماژول‌های هوش مصنوعی، به صفحه **[طراحی سیستم هوش مصنوعی (AI System Design)](?page=aiSystem)** مراجعه کنید.

---

## سرویس‌های Gemini (`services/geminiService.ts`)

این فایل شامل تمام تعاملات با Google Gemini API است.

### `generateReport(topic, description, reportType)`

-   **توضیحات:** یک گزارش متنی (مانند طرح عملیاتی پناهگاه) را بر اساس موضوع، توضیحات و نوع گزارش انتخاب شده، تولید می‌کند. از جستجوی وب برای غنی‌سازی محتوا استفاده می‌کند.
-   **پارامترها:**
    -   `topic` (string): موضوع اصلی گزارش.
    -   `description` (string): جزئیات و نکات کلیدی برای تولید محتوا.
    -   `reportType` (string): نوع گزارش (مثلاً 'shelter_plan').
-   **خروجی:** `Promise<GroundedResult>` - یک Promise که به یک شیء با دو کلید `text` (محتوای گزارش) و `sources` (لیست منابع وب استفاده شده) حل می‌شود.

### `findGrants(prompt)`

-   **توضیحات:** با استفاده از ابزار جستجوی گوگل (Google Search grounding)، گرنت‌های مرتبط با یک پرامپت کامل (که می‌تواند شامل کلمات کلیدی و متن سند باشد) را جستجو می‌کند.
-   **پارامترها:**
    -   `prompt` (string): پرامپت کامل شامل کلمات کلیدی یا محتوای سند برای جستجو.
-   **خروجی:** `Promise<GrantResult>` - یک Promise که به یک شیء با دو کلید `text` (پاسخ متنی مدل، معمولاً یک جدول Markdown) و `sources` (لیست منابع وب استفاده شده) حل می‌شود.

### `analyzeGrant(grant, userProfile)`

-   **توضیحات:** یک گرنت مشخص را تحلیل کرده و با استفاده از جستجوی وب، جزئیات آن را استخراج و یک خلاصه ساختاریافته در قالب JSON برمی‌گرداند.
-   **پارامترها:**
    -   `grant` (Grant): شیء گرنت حاوی اطلاعات اولیه.
    -   `userProfile` (string): توضیحی از پروفایل سازمان (مثلاً پناهگاه حیوانات) برای ارزیابی میزان ارتباط.
-   **خروجی:** `Promise<GrantSummary>` - یک Promise که به یک شیء JSON با جزئیات کامل گرنت (مانند مبلغ، ددلاین، شرایط و ...) حل می‌شود.

### `findPlantingSites(description)`

-   **توضیحات:** **(تغییر کاربری)** این تابع اکنون برای یافتن مکان‌های مناسب برای عملیات نجات یا تأسیس پناهگاه استفاده می‌شود.
-   **پارامترها:**
    -   `description` (string): توضیحات کاربر در مورد اهداف پروژه نجات.
-   **خروجی:** `Promise<PlantingSite[]>` - آرایه‌ای از مکان‌های پیشنهادی با جزئیات.

### `findSuitableTrees(latitude, longitude)`

-   **توضیحات:** **(تغییر کاربری)** این تابع اکنون برای پیشنهاد نژادها یا گونه‌های حیوانی مناسب برای یک محیط جغرافیایی خاص استفاده می‌شود.
-   **پارامترها:**
    -   `latitude` (number), `longitude` (number): مختصات جغرافیایی.
-   **خروجی:** `Promise<SuitableTree[]>` - آرایه‌ای از حیوانات پیشنهادی.

### `generateVideoScript(...)`

-   **توضیحات:** یک اسکریپت ویدیویی کامل، شامل صحنه‌ها، نریشن و توضیحات بصری را بر اساس ورودی کاربر (متن و/یا تصویر) تولید می‌کند.
-   **پارامترها:**
    -   `prompt` (string): توضیحات کاربر در مورد مفهوم ویدیو.
    -   `image` (string | null): تصویر مرجع برای راهنمایی سبک بصری.
    -   `duration` (number): مدت زمان تقریبی ویدیو به ثانیه.
    -   `videoType` ('general' | 'research_showcase'): نوع ویدیو.
-   **خروجی:** `Promise<ScriptScene[]>` - یک Promise که به آرایه‌ای از اشیاء `VideoScene` حل می‌شود.

### `generateSceneImage(description)`

-   **توضیحات:** یک تصویر ثابت برای یک صحنه بر اساس توضیحات بصری آن با استفاده از مدل `gemini-2.5-flash-image` تولید می‌کند.
-   **پارامترها:**
    -   `description` (string): توضیحات بصری برای تولید تصویر.
-   **خروجی:** `Promise<string>` - یک Promise که به یک URL داده (Data URL) از تصویر تولید شده (base64) حل می‌شود.

---

## سرویس پایگاه داده (`services/dbService.ts`)

این فایل توابع مربوط به مدیریت پایگاه داده IndexedDB در مرورگر را برای ذخیره گرنت‌ها فراهم می‌کند.

### `initDB()`

-   **توضیحات:** پایگاه داده IndexedDB را با نام و نسخه مشخص شده راه‌اندازی می‌کند.
-   **پارامترها:** ندارد.
-   **خروجی:** `Promise<boolean>` - در صورت موفقیت `true` برمی‌گرداند.

### `addGrants(grants)`

-   **توضیحات:** آرایه‌ای از گرنت‌ها را در پایگاه داده ذخیره یا به‌روزرسانی می‌کند.
-   **پارامترها:**
    -   `grants` (Grant[]): لیستی از اشیاء گرنت.
-   **خروجی:** `Promise<void>` - پس از اتمام عملیات حل می‌شود.

### `getAllGrants()`

-   **توضیحات:** تمام گرنت‌های ذخیره شده در پایگاه داده را بازیابی می‌کند.
-   **پارامترها:** ندارد.
-   **خروجی:** `Promise<Grant[]>` - یک Promise که به آرایه‌ای از گرنت‌های ذخیره شده حل می‌شود.

### `clearAllGrants()`

-   **توضیحات:** تمام داده‌های موجود در انبار گرنت‌ها را پاک می‌کند.
-   **پارامترها:** ندارد.
-   **خروجی:** `Promise<void>` - پس از پاک‌سازی کامل حل می‌شود.

---

## کامپوننت‌های اصلی برنامه (`App.tsx`)

این فایل شامل منطق اصلی برنامه و مدیریت state کلی است.

### `handleGenerateReport(topic, description, reportType)`

-   **توضیحات:** فرآیند تولید گزارش را با فراخوانی `generateReport` آغاز کرده و نتایج را در state برنامه به‌روزرسانی می‌کند.

### `handleFindGrants(prompt)`

-   **توضیحات:** با فراخوانی `findGrants`، گرنت‌ها را جستجو کرده و لیست نتایج را در state قرار می‌دهد.

### `handleAnalyzeGrant(grant)`

-   **توضیحات:** فرآیند تحلیل یک گرنت مشخص را با فراخوانی `analyzeGrant` آغاز کرده و نتیجه را برای نمایش در `GrantAdopter` در state ذخیره می‌کند.

### `renderPage()`

-   **توضیحات:** بر اساس مقدار `page` در state، کامپوننت مربوط به صفحه فعلی را رندر می‌کند. این تابع شامل منطق مسیریابی داخلی برنامه است و صفحات زیر را مدیریت می‌کند:
    -   `home`: صفحه اصلی
    -   `projects`: نمونه کارها و مأموریت‌ها
    -   `team`: معرفی تیم
    -   `docs`: مستندات توابع (این صفحه)
    -   `research`: تحقیق و توسعه
    -   `aiSystem`: طراحی سیستم هوش مصنوعی
    -   `seo`: مرکز سئو
    -   `generator`: برنامه‌ریز پناهگاه
    -   `grant`: گرنت یاب
    -   `siteSelector`: نقشه نجات
    -   `video`: ویدیو ساز
    -   `imageEditor`: ویرایشگر عکس
    -   `blog`: مرکز محتوا (داستان‌سرای نجات)
